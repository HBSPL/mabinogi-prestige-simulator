<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë³€ë™ í™•ë¥  ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { font-size: 1rem; padding: .4rem; margin: .2rem; }
    .section { border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; }
    .log { white-space: pre-wrap; background: #f9f9f9; padding: .5rem; height: 8em; overflow-y: auto; }
  </style>
</head>
<body>

  <h1>ë„¥ìŠ¨ì‹ ë³€ë™ í™•ë¥  ì‹œë®¬ë ˆì´í„°</h1>

  <div class="section">
    <h2>ì„¤ì •</h2>
    <label>ëª©í‘œ í™•ë¥  (íŠ¸ë Œë“œâ†’ì—£ì§€) <input id="targetTrend" type="number" value="10" min="0" max="100">%</label><br>
    <label>ëª©í‘œ í™•ë¥  (ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€) <input id="targetPrest" type="number" value="5" min="0" max="100">%</label><br>
    <label>ê°€ìƒ ì‹œë®¬ë ˆì´ì…˜ ë²”ìœ„ <input id="fakeMin" type="number" value="100" min="1"> ~ <input id="fakeMax" type="number" value="200" min="1"> íšŒ</label>
  </div>

  <div class="section">
    <h2>ë‹¨ê³„ë³„ ë„ì „</h2>
    <button onclick="tryUpgrade('trend')">íŠ¸ë Œë“œ â†’ ì—£ì§€ ë„ì „</button>
    <button onclick="tryUpgrade('prest')">ì—£ì§€ â†’ í”„ë ˆìŠ¤í‹°ì§€ ë„ì „</button>
  </div>

  <div class="section">
    <h2>í˜„ì¬ ìƒíƒœ</h2>
    <p>ëˆ„ì  ì‹œë„: <span id="totalAttempts">0</span> íšŒ</p>
    <p>ëˆ„ì  ì„±ê³µ: <span id="totalSuccesses">0</span> íšŒ</p>
    <p>ì‹¤ì œ ì ìš© í™•ë¥ : <span id="currentRate">-</span>%</p>
  </div>

  <div class="section">
    <h2>ë¡œê·¸</h2>
    <div id="log" class="log"></div>
    <button onclick="resetAll()">ğŸ—‘ ì´ˆê¸°í™”</button>
  </div>

  <script>
    // ì´ˆê¸°í™”
    function initStorage() {
      if (!localStorage.getItem('totalAttempts')) {
        localStorage.setItem('totalAttempts', '0');
        localStorage.setItem('totalSuccesses', '0');
      }
      updateDisplay();
    }
    initStorage();

    // í˜„ì¬ ëˆ„ì ê°’ í‘œì‹œ
    function updateDisplay() {
      document.getElementById('totalAttempts').innerText = localStorage.getItem('totalAttempts');
      document.getElementById('totalSuccesses').innerText = localStorage.getItem('totalSuccesses');
    }

    // ë™ì  í™•ë¥  ê³„ì‚° (ì„œë²„ê³µìœ  ê°€ì •)
    function getDynamicRate(target) {
      const attempts = +localStorage.getItem('totalAttempts');
      const successes = +localStorage.getItem('totalSuccesses');
      if (attempts === 0) return target;
      const actual = successes / attempts;
      const coef = 2;  // ë°˜ì‘ì†ë„ ê³„ìˆ˜
      let adj = (target/100 - actual) * coef;
      let rate = target/100 + adj;
      rate = Math.max(0.001, Math.min(1, rate));
      return rate;
    }

    // ê°€ìƒ ìœ ì € ì‹œë®¬ë ˆì´ì…˜ ëˆ„ì 
    function simulateFakes() {
      const min = +document.getElementById('fakeMin').value;
      const max = +document.getElementById('fakeMax').value;
      const count = Math.floor(Math.random()*(max-min+1)) + min;
      for (let i=0; i<count; i++) {
        const rate = getDynamicRate(currentContext==='trend'? +document.getElementById('targetTrend').value : +document.getElementById('targetPrest').value);
        localStorage.totalAttempts = +localStorage.totalAttempts + 1;
        if (Math.random() < rate) {
          localStorage.totalSuccesses = +localStorage.totalSuccesses + 1;
        }
      }
    }

    let currentContext = null;
    function tryUpgrade(which) {
      currentContext = which;
      // 1) ê°€ìƒ ìœ ì € ëˆ„ì 
      simulateFakes();

      // 2) ì‹¤ì œ 1íšŒ ë„ì „
      const target = which==='trend'
                   ? +document.getElementById('targetTrend').value
                   : +document.getElementById('targetPrest').value;
      const rate = getDynamicRate(target);
      localStorage.totalAttempts = +localStorage.totalAttempts + 1;
      const ok = Math.random() < rate;
      if (ok) localStorage.totalSuccesses = +localStorage.totalSuccesses + 1;

      // 3) ë¡œê·¸ ë° í™”ë©´ ê°±ì‹ 
      const log = document.getElementById('log');
      const line = `[${which==='trend'?'Tâ†’E':'Eâ†’P'}] ` +
                   (ok ? `%cì„±ê³µ` : `%cì‹¤íŒ¨`) +
                   ` (í™•ë¥  ${ (rate*100).toFixed(2) }%)`;
      // ìƒ‰ìƒ ì ìš©
      log.insertAdjacentHTML('beforeend',
        line.replace('%cì„±ê³µ', '<span style="color:red">ì„±ê³µ</span>')
            .replace('%cì‹¤íŒ¨', '<span style="color:blue">ì‹¤íŒ¨</span>')
        + '<br>');
      log.scrollTop = log.scrollHeight;

      updateDisplay();
      document.getElementById('currentRate').innerText = (rate*100).toFixed(2);
    }

    function resetAll() {
      localStorage.setItem('totalAttempts','0');
      localStorage.setItem('totalSuccesses','0');
      document.getElementById('log').innerText = '';
      updateDisplay();
      document.getElementById('currentRate').innerText = '-';
    }
  </script>

</body>
</html>
