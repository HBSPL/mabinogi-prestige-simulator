<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¯¸ìŠ¤í‹± ì•„í‹€ë¦¬ì— ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: sans-serif;
      margin: 10px;
      padding: 0 10px;
      max-width: 100%;
    }

    input, button {
      font-size: 1.1rem;
      padding: .6rem;
      margin: .3rem 0;
      width: 100%;
      box-sizing: border-box;
      background-color: #2a2a2a;
      color: #f0f0f0;
      border: 1px solid #444;
      border-radius: 4px;
    }

    label {
      display: block;
      margin: 10px 0 5px;
    }

    .log {
      white-space: pre-wrap;
      background: #1e1e1e;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      border: 1px solid #444;
      font-size: 0.95rem;
      margin-bottom: 15px;
    }

    .success { color: #ff6b6b; }
    .fail { color: #6bc1ff; }

    h1, h3 {
      text-align: center;
      color: #ffffff;
    }

    #config {
      display: none;
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .button-row button {
      flex: 1;
    }
  </style>

</head>
<body>

<h3>ğŸ² ë¯¸ìŠ¤í‹± ì•„í‹€ë¦¬ì— ì‹œë®¬ë ˆì´í„°</h3>

<div class="log" id="log"></div>

<button onclick="toggleConfig()">âš™ï¸ ì„¤ì • ë³´ê¸°/ìˆ¨ê¸°ê¸°</button>

<div id="config">
  <label>ğŸ’° ì´ˆê¸° ì”ê³ </label>
  <input id="balance_start" type="text" value="3,000,000,000">

  <label>ğŸ‘• íŠ¸ë Œë“œ 1ê°œ ê°€ê²©</label>
  <input id="trend_price" type="text" value="2,500,000">

  <label>ğŸ§¥ ì—£ì§€ 1ê°œ ê°€ê²©</label>
  <input id="edge_price" type="text" value="40,000,000">

  <label>ğŸ‘‘ í”„ë ˆìŠ¤í‹°ì§€ ì‹œì¥ê°€</label>
  <input id="prest_price" type="text" value="600,000,000">

  <label>ğŸ’µ íŠ¸ë Œë“œâ†’ì—£ì§€ ë¹„ìš©</label>
  <input id="cost_trend2edge" type="text" value="2,000,000">

  <label>ğŸ’µ ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ë¹„ìš©</label>
  <input id="cost_edge2prest" type="text" value="4,200,000">
</div>

<div id="status"></div>

<hr>

<!-- ë²„íŠ¼ ì„¹ì…˜ -->
<div class="button-row">
  <button onclick="buy('trend')">íŠ¸ë Œë“œ êµ¬ë§¤</button>
  <button onclick="buy('edge')">ì—£ì§€ êµ¬ë§¤</button>
</div>
<div class="button-row">
  <button onclick="upgrade('trend2edge')">íŠ¸ë Œë“œâ†’ì—£ì§€ ë„ì „</button>
  <button onclick="upgrade('edge2prest')">ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ë„ì „</button>
</div>
<div class="button-row">
  <button onclick="reset()">ğŸ”„ ì´ˆê¸°í™”</button>
</div>


<script>
let state = {
  balance: 0,
  trend: 0,
  edge: 0,
  prestige: 0,
  spent: 0,
  prestige_success: 0,
  prestige_attempts: 0,
  trend2edge_attempts: 0,
  trend2edge_success: 0
};


function toggleConfig() {
  const config = document.getElementById("config");
  config.style.display = config.style.display === "none" ? "block" : "none";
}

function parseMoney(str) {
  return parseInt(str.replace(/,/g, '')) || 0;
}

function formatMoney(num) {
  return num.toLocaleString();
}

function getDynamicRate(target) {
  const attempts = parseInt(localStorage.getItem("totalAttempts") || "0");
  const successes = parseInt(localStorage.getItem("totalSuccesses") || "0");
  if (attempts === 0) return target;
  const actual = successes / attempts;
  const coef = 2;
  let adj = (target - actual) * coef;
  return Math.max(0.001, Math.min(1.0, target + adj));
}

function simulateFakeUsers(rate) {
  const count = Math.floor(Math.random() * 50) + 1;
  let attempts = parseInt(localStorage.getItem("totalAttempts") || "0");
  let successes = parseInt(localStorage.getItem("totalSuccesses") || "0");
  for (let i = 0; i < count; i++) {
    attempts++;
    if (Math.random() < rate) successes++;
  }
  localStorage.setItem("totalAttempts", attempts);
  localStorage.setItem("totalSuccesses", successes);
}

function buy(type) {
  if (state.prestige >= 4) return;
  const price = parseMoney(document.getElementById(type + "_price").value);
  if (state.balance >= price) {
    state[type]++;
    state.balance -= price;
    state.spent += price;
    log(`âœ… ${type === 'trend' ? 'íŠ¸ë Œë“œ' : 'ì—£ì§€'} 1ê°œ êµ¬ë§¤`, "success");
  } else {
    log(`âŒ ì”ê³  ë¶€ì¡±`, "fail");
  }
  updateStatus();
  saveState();
}

function upgrade(type) {
  if (state.prestige >= 4) return;

  if (type === 'trend2edge') {
    if (state.trend < 3) return log("âŒ íŠ¸ë Œë“œ ë¶€ì¡±", "fail");
    const cost = parseMoney(document.getElementById("cost_trend2edge").value);
    if (state.balance < cost) return log("âŒ ì”ê³  ë¶€ì¡±", "fail");

    const targetRate = getDynamicRate(0.10);
    simulateFakeUsers(0.10);

    state.trend -= 3;
    state.balance -= cost;
    state.spent += cost;
    state.trend2edge_attempts++; // ì¶”ê°€

    if (Math.random() < targetRate) {
      state.edge++;
      state.trend2edge_success++; // ì¶”ê°€
      log("ğŸ¯ íŠ¸ë Œë“œâ†’ì—£ì§€ ì„±ê³µ!", "success");
    } else {
      state.trend += 1;
      log("ğŸ’¥ íŠ¸ë Œë“œâ†’ì—£ì§€ ì‹¤íŒ¨ (íŠ¸ë Œë“œ 1ê°œ ë°˜í™˜)", "fail");
    }
  }

  if (type === 'edge2prest') {
    if (state.edge < 2) return log("âŒ ì—£ì§€ ë¶€ì¡±", "fail");
    const cost = parseMoney(document.getElementById("cost_edge2prest").value);
    if (state.balance < cost) {
      log("âŒ ì”ê³  ë¶€ì¡±", "fail");
      if (state.prestige < 4) {
        alert("â—ë‹¹ì‹ ì˜ ìš´ì´ë¼ë©´ êµ¬ë§¤í•˜ëŠ” ê±¸ ì¶”ì²œí•©ë‹ˆë‹¤.");
      }
      return;
    }
    const targetRate = getDynamicRate(0.05);
    simulateFakeUsers(0.05);
    state.edge -= 2;
    state.balance -= cost;
    state.spent += cost;
    state.prestige_attempts++;
    if (Math.random() < targetRate) {
      state.prestige++;
      state.prestige_success++;
      log("ğŸ† ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ì„±ê³µ!", "success");
      if (state.prestige >= 4) {
        alert("ğŸ‰ í”„ë ˆìŠ¤í‹°ì§€ 4ê°œ ì œì‘ ì™„ë£Œ! ì‹œë®¬ë ˆì´ì…˜ì´ ì¢…ë£Œë©ë‹ˆë‹¤.");
      }
    } else {
      state.edge += 1;
      log("âŒ ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ì‹¤íŒ¨ (ì—£ì§€ 1ê°œ ë°˜í™˜)", "fail");
    }
  }

  updateStatus();
  saveState();
}
function saveState() {
  localStorage.setItem("simulatorState", JSON.stringify(state));
}

function loadState() {
  const saved = localStorage.getItem("simulatorState");
  if (saved) {
    try {
      state = JSON.parse(saved);
    } catch (e) {
      console.error("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë¨");
    }
  } else {
    // ì²˜ìŒ ë°©ë¬¸í•œ ì‚¬ìš©ìì¼ ê²½ìš° ì´ˆê¸°ê°’ìœ¼ë¡œ ì„¤ì •
    state = {
      balance: parseMoney(document.getElementById("balance_start").value),
      trend: 0,
      edge: 0,
      prestige: 0,
      spent: 0,
      prestige_success: 0,
      prestige_attempts: 0,
      trend2edge_attempts: 0,
      trend2edge_success: 0
    };
    saveState(); // ì €ì¥í•´ë‘ê¸°
  }
}


function updateStatus() {
  const market = parseMoney(document.getElementById("prest_price").value);
  const status = document.getElementById("status");
  let result = `
ğŸ’° ì”ê³ : ${formatMoney(state.balance)} ê³¨ë“œ
ğŸ‘• íŠ¸ë Œë“œ: ${state.trend}ê°œ
ğŸ§¥ ì—£ì§€: ${state.edge}ê°œ
ğŸ§ª íŠ¸ë Œë“œâ†’ì—£ì§€ ì‹œë„: ${state.trend2edge_attempts}íšŒ
ğŸ¯ íŠ¸ë Œë“œâ†’ì—£ì§€ ì„±ê³µ: ${state.trend2edge_success}íšŒ (${state.trend2edge_attempts > 0 ? ((state.trend2edge_success / state.trend2edge_attempts) * 100).toFixed(1) : 0}%)
ğŸ‘‘ í”„ë ˆìŠ¤í‹°ì§€: ${state.prestige}ê°œ
ğŸ” í”„ë ˆìŠ¤í‹°ì§€ ì‹œë„: ${state.prestige_attempts}íšŒ
âœ… í”„ë ˆìŠ¤í‹°ì§€ ì„±ê³µ: ${state.prestige_success}íšŒ (${state.prestige_attempts > 0 ? ((state.prestige_success / state.prestige_attempts) * 100).toFixed(1) : 0}%)
ğŸ’¸ ì´ ì†Œë¹„ ê¸ˆì•¡: ${formatMoney(state.spent)} ê³¨ë“œ`;

  if (state.prestige_success > 0) {
    const avgCost = state.spent / state.prestige_success;
    const diff = avgCost - market;
    const percent = (diff / market) * 100;
    if (diff > 0) {
      result += `\nğŸ“ˆ í‰ê·  ì œì‘ë¹„ê°€ ì‹œì¥ê°€ë³´ë‹¤ ${formatMoney(Math.abs(diff))}ê³¨ë“œ (${percent.toFixed(2)}%) ë” ë¹„ìŒ‰ë‹ˆë‹¤.`;
    } else {
      result += `\nğŸ“‰ í‰ê·  ì œì‘ë¹„ê°€ ì‹œì¥ê°€ë³´ë‹¤ ${formatMoney(Math.abs(diff))}ê³¨ë“œ (${Math.abs(percent).toFixed(2)}%) ë” ì €ë ´í•©ë‹ˆë‹¤.`;
    }
  }

  status.innerText = result;
}

function log(msg, type) {
  const box = document.getElementById("log");
  const line = document.createElement("div");
  line.className = type;
  line.innerText = msg;
  box.appendChild(line);
  box.scrollTop = box.scrollHeight;
}

function reset() {
  state = {
    balance: parseMoney(document.getElementById("balance_start").value),
    trend: 0,
    edge: 0,
    prestige: 0,
    spent: 0,
    prestige_success: 0,
    prestige_attempts: 0,
    trend2edge_attempts: 0,
    trend2edge_success: 0
  };
  localStorage.removeItem("simulatorState"); // ìƒíƒœ ì´ˆê¸°í™”
  localStorage.setItem("totalAttempts", "0");
  localStorage.setItem("totalSuccesses", "0");
  document.getElementById("log").innerHTML = "";
  saveState();
  updateStatus();
}

loadState();
updateStatus();
</script>

</body>
</html>
