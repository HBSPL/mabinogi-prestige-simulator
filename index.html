<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>íŒŒì´ë„ ë°ìŠ¤í‹° ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 20px auto; }
    input, button { font-size: 1rem; padding: .4rem; margin: .3rem 0; }
    input[type="text"] { width: 200px; }
    .log { white-space: pre-wrap; background: #f1f1f1; padding: 10px; height: 200px; overflow-y: auto; border: 1px solid #ccc; }
    .success { color: red; }
    .fail { color: blue; }
  </style>
</head>
<body>

<h1>ğŸ² íŒŒì´ë„ ë°ìŠ¤í‹° ì‹œë®¬ë ˆì´í„°</h1>

<div>
  <label>ğŸ’° ì´ˆê¸° ì”ê³ : <input id="balance_start" type="text" value="3,000,000,000"></label><br>
  <label>ğŸ‘• íŠ¸ë Œë“œ 1ê°œ ê°€ê²©: <input id="trend_price" type="text" value="2,500,000"></label><br>
  <label>ğŸ§¥ ì—£ì§€ 1ê°œ ê°€ê²©: <input id="edge_price" type="text" value="40,000,000"></label><br>
  <label>ğŸ‘‘ í”„ë ˆìŠ¤í‹°ì§€ ì‹œì¥ê°€: <input id="prest_price" type="text" value="600,000,000"></label><br>
  <label>ğŸ’µ íŠ¸ë Œë“œâ†’ì—£ì§€ ë¹„ìš©: <input id="cost_trend2edge" type="text" value="2,000,000"></label><br>
  <label>ğŸ’µ ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ë¹„ìš©: <input id="cost_edge2prest" type="text" value="4,200,000"></label>
</div>

<hr>

<div>
  <button onclick="buy('trend')">íŠ¸ë Œë“œ êµ¬ë§¤</button>
  <button onclick="buy('edge')">ì—£ì§€ êµ¬ë§¤</button>
</div>
<div>
  <button onclick="upgrade('trend2edge')">íŠ¸ë Œë“œâ†’ì—£ì§€ ë„ì „</button>
  <button onclick="upgrade('edge2prest')">ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ë„ì „</button>
</div>
<button onclick="reset()">ğŸ”„ ì´ˆê¸°í™”</button>

<h3>ğŸ“Š ê²°ê³¼</h3>
<div id="status"></div>
<h3>ğŸ“£ ë¡œê·¸</h3>
<div class="log" id="log"></div>

<script>
let state = {
  balance: 0,
  trend: 0,
  edge: 0,
  prestige: 0,
  spent: 0,
  prestige_success: 0,
  prestige_attempts: 0
};

function parseMoney(str) {
  return parseInt(str.replace(/,/g, '')) || 0;
}

function formatMoney(num) {
  return num.toLocaleString();
}

function getDynamicRate(target) {
  const attempts = parseInt(localStorage.getItem("totalAttempts") || "0");
  const successes = parseInt(localStorage.getItem("totalSuccesses") || "0");
  if (attempts === 0) return target;

  const actual = successes / attempts;
  const coef = 2;
  let adj = (target - actual) * coef;
  let result = target + adj;
  return Math.max(0.001, Math.min(1.0, result));
}

function simulateFakeUsers(rate) {
  const count = Math.floor(Math.random() * 101) + 100;
  let attempts = parseInt(localStorage.getItem("totalAttempts") || "0");
  let successes = parseInt(localStorage.getItem("totalSuccesses") || "0");

  for (let i = 0; i < count; i++) {
    attempts++;
    if (Math.random() < rate) successes++;
  }

  localStorage.setItem("totalAttempts", attempts);
  localStorage.setItem("totalSuccesses", successes);
}

function buy(type) {
  const price = parseMoney(document.getElementById(type + "_price").value);
  if (state.balance >= price) {
    state[type]++;
    state.balance -= price;
    state.spent += price;
    log(`âœ… ${type === 'trend' ? 'íŠ¸ë Œë“œ' : 'ì—£ì§€'} 1ê°œ êµ¬ë§¤`, "success");
  } else {
    log(`âŒ ì”ê³  ë¶€ì¡±`, "fail");
  }
  updateStatus();
}

function upgrade(type) {
  if (type === 'trend2edge') {
    if (state.trend < 3) return log("âŒ íŠ¸ë Œë“œ ë¶€ì¡±", "fail");
    const cost = parseMoney(document.getElementById("cost_trend2edge").value);
    if (state.balance < cost) return log("âŒ ì”ê³  ë¶€ì¡±", "fail");

    const targetRate = getDynamicRate(0.10);
    simulateFakeUsers(0.10);

    state.trend -= 3;
    state.balance -= cost;
    state.spent += cost;

    if (Math.random() < targetRate) {
      state.edge++;
      log("ğŸ¯ íŠ¸ë Œë“œâ†’ì—£ì§€ ì„±ê³µ!", "success");
    } else {
      state.trend += 1; // 1ê°œ ë°˜í™˜
      log("ğŸ’¥ íŠ¸ë Œë“œâ†’ì—£ì§€ ì‹¤íŒ¨ (íŠ¸ë Œë“œ 1ê°œ ë°˜í™˜)", "fail");
    }
  }

  if (type === 'edge2prest') {
    if (state.edge < 2) return log("âŒ ì—£ì§€ ë¶€ì¡±", "fail");
    const cost = parseMoney(document.getElementById("cost_edge2prest").value);
    if (state.balance < cost) return log("âŒ ì”ê³  ë¶€ì¡±", "fail");

    const targetRate = getDynamicRate(0.05);
    simulateFakeUsers(0.05);

    state.edge -= 2;
    state.balance -= cost;
    state.spent += cost;
    state.prestige_attempts++;

    if (Math.random() < targetRate) {
      state.prestige++;
      state.prestige_success++;
      log("ğŸ† ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ì„±ê³µ!", "success");
    } else {
      state.edge += 1;
      log("âŒ ì—£ì§€â†’í”„ë ˆìŠ¤í‹°ì§€ ì‹¤íŒ¨ (ì—£ì§€ 1ê°œ ë°˜í™˜)", "fail");
    }
  }

  updateStatus();
}

function updateStatus() {
  const market = parseMoney(document.getElementById("prest_price").value);
  const status = document.getElementById("status");
  let result = `
ğŸ’° ì”ê³ : ${formatMoney(state.balance)} ê³¨ë“œ
ğŸ‘• íŠ¸ë Œë“œ: ${state.trend}ê°œ
ğŸ§¥ ì—£ì§€: ${state.edge}ê°œ
ğŸ‘‘ í”„ë ˆìŠ¤í‹°ì§€: ${state.prestige}ê°œ
ğŸ” í”„ë ˆìŠ¤í‹°ì§€ ì‹œë„: ${state.prestige_attempts}íšŒ
âœ… ì„±ê³µ íšŸìˆ˜: ${state.prestige_success}íšŒ
ğŸ’¸ ì´ ì†Œë¹„ ê¸ˆì•¡: ${formatMoney(state.spent)} ê³¨ë“œ`;

  if (state.prestige_success > 0) {
    const avgCost = state.spent / state.prestige_success;
    const diff = avgCost - market;
    const percent = (diff / market) * 100;
    if (diff > 0) {
      result += `\nğŸ“ˆ í‰ê·  ì œì‘ë¹„ê°€ ì‹œì¥ê°€ë³´ë‹¤ ${formatMoney(Math.abs(diff))}ê³¨ë“œ (${percent.toFixed(2)}%) ë” ë¹„ìŒ‰ë‹ˆë‹¤.`;
    } else {
      result += `\nğŸ“‰ í‰ê·  ì œì‘ë¹„ê°€ ì‹œì¥ê°€ë³´ë‹¤ ${formatMoney(Math.abs(diff))}ê³¨ë“œ (${Math.abs(percent).toFixed(2)}%) ë” ì €ë ´í•©ë‹ˆë‹¤.`;
    }
  }

  status.innerText = result;
}

function log(msg, type) {
  const box = document.getElementById("log");
  const line = document.createElement("div");
  line.className = type;
  line.innerText = msg;
  box.appendChild(line);
  box.scrollTop = box.scrollHeight;
}

function reset() {
  state = {
    balance: parseMoney(document.getElementById("balance_start").value),
    trend: 0,
    edge: 0,
    prestige: 0,
    spent: 0,
    prestige_success: 0,
    prestige_attempts: 0
  };
  document.getElementById("log").innerHTML = "";
  localStorage.setItem("totalAttempts", "0");
  localStorage.setItem("totalSuccesses", "0");
  updateStatus();
}

reset();
</script>

</body>
</html>
